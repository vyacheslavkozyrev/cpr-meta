# Phase 8: Deploy - AI-Assisted Deployment

**Context**: You are assisting with Phase 8 (Deploy) of the CPR Feature Development Framework. This phase deploys a feature to production after successful testing in Phase 7.

---

## Prerequisites

Before starting Phase 8, ensure:
- ‚úÖ Phase 7 (Test) complete with `test-report.md` showing READY or CONDITIONAL status
- ‚úÖ Production readiness score ‚â•75/100
- ‚úÖ All CRITICAL and HIGH issues resolved
- ‚úÖ UAT approval obtained from stakeholders
- ‚úÖ `automation-deploy.json` generated by phase-8-deploy.ps1
- ‚úÖ `deployment-plan.md` template populated with checklist

---

## Operating Constraints

### Constitutional Compliance
All 11 CPR Constitutional Principles must remain satisfied:
1. **Specification-Driven**: Feature traceable to specifications
2. **API Contract Consistency**: DTOs match between backend/frontend
3. **Framework Integration**: ASP.NET Core + React patterns followed
4. **Type Safety**: No `any` or `dynamic` used
5. **Offline-First**: React Query caching, IndexedDB persistence
6. **Internationalization**: i18n keys for all UI text
7. **Comprehensive Testing**: Tests passing in CI/CD
8. **Performance**: API <200ms, UI <1s maintained in production
9. **Security**: Authentication/authorization working
10. **Accessibility**: WCAG 2.1 AA compliance verified
11. **Framework Tools**: All phases completed properly

### Deployment Safety
- **Zero Downtime**: Use blue-green, rolling, or canary deployment
- **Rollback Ready**: Immediate rollback capability if issues detected
- **Monitoring First**: Alerts configured before deployment
- **Database Safety**: Migrations tested, backups verified
- **Feature Flags**: Ability to disable feature without redeployment (preferred)

---

## Workflow

### Step 1: Review Automated Deployment Validation

Load and analyze `automation-deploy.json`:

**Check Prerequisites**:
- Phase 7 production readiness status (READY/CONDITIONAL/NOT READY)
- CI/CD pipeline status (all checks passing?)
- Merge conflict status (clean merge possible?)
- Database migration validation
- Environment configuration validation

**If NOT READY**:
- Document blockers
- Return to Phase 7 to resolve issues
- Do NOT proceed with deployment

**If CONDITIONAL**:
- Review documented issues and mitigations
- Verify enhanced monitoring plan
- Confirm stakeholder approval for conditional deployment
- Document known limitations

**If READY**:
- Proceed with confidence
- Standard monitoring sufficient

### Step 2: Review Test Report

Open `test-report.md` from Phase 7:

**Validate**:
- ‚úÖ Production readiness score ‚â•75/100
- ‚úÖ Integration tests 100% passing
- ‚úÖ E2E tests covering critical journeys
- ‚úÖ Performance targets met
- ‚úÖ No HIGH/CRITICAL security vulnerabilities
- ‚úÖ Accessibility compliance verified
- ‚úÖ UAT sign-off obtained

**Document in deployment plan**:
- Key test metrics
- Known issues (if CONDITIONAL)
- Monitoring priorities based on test findings

### Step 3: Pre-Deployment Validation

**Environment Checks**:
```markdown
### Pre-Deployment Validation Checklist

#### Infrastructure
- [ ] Staging environment healthy
- [ ] Production environment capacity verified
- [ ] Load balancers configured
- [ ] CDN cache invalidation plan ready
- [ ] SSL certificates valid

#### Code Readiness
- [ ] Feature branch up to date with main
- [ ] No merge conflicts
- [ ] All CI/CD checks passing
- [ ] Code review approved (Phase 6)
- [ ] Release version tagged

#### Database
- [ ] Migration scripts reviewed
- [ ] Rollback scripts prepared
- [ ] Database backups verified
- [ ] Migration tested in staging
- [ ] Data integrity checks ready

#### Configuration
- [ ] Environment variables documented
- [ ] Secrets/credentials configured
- [ ] Feature flags configured
- [ ] API keys valid
- [ ] CORS settings correct

#### Monitoring
- [ ] Application logs accessible
- [ ] Error tracking configured (e.g., Sentry)
- [ ] Performance monitoring active (e.g., Application Insights)
- [ ] Alert rules configured
- [ ] Dashboard prepared

#### Communication
- [ ] Deployment window scheduled
- [ ] Stakeholders notified
- [ ] Support team briefed
- [ ] Rollback plan documented
- [ ] Emergency contacts listed
```

### Step 4: Merge to Main Branch

**Create Pull Request**:
```markdown
### Pull Request: [Feature Name]

**Feature**: ####-feature-name

**Summary**: [Brief description of feature]

**Changes**:
- Backend: [Summary of API changes]
- Frontend: [Summary of UI changes]
- Database: [Migration description, if any]

**Testing**:
- Phase 6 Code Review: APPROVED (score: __/100)
- Phase 7 Testing: READY/CONDITIONAL (score: __/100)
- All tests passing in CI/CD

**Documentation**:
- [ ] API documentation updated
- [ ] User documentation updated
- [ ] CHANGELOG.md updated
- [ ] Deployment plan prepared

**Deployment Plan**:
- Staging deployment: [Date/Time]
- Production deployment: [Date/Time]
- Rollback plan: [Summary]

**Approval Required**: Tech Lead / Solution Owner

Closes #[issue-number]
```

**Merge Strategy**:
- Squash merge: Single commit to main (preferred for clean history)
- Merge commit: Preserve feature branch history
- Follow team/project policy

**Post-Merge**:
```bash
# Tag release version (semantic versioning)
git tag -a v1.2.0 -m "Feature: ####-feature-name"
git push origin v1.2.0
```

### Step 5: Deploy to Staging

**Backend Deployment (cpr-api)**:
```bash
# Typical Azure App Service deployment
az webapp deployment source config-zip \
  --resource-group <resource-group> \
  --name <app-service-name-staging> \
  --src <build-artifact.zip>

# Or via GitHub Actions / Azure DevOps pipeline
# Trigger staging deployment pipeline
```

**Frontend Deployment (cpr-ui)**:
```bash
# Build production bundle
npm run build

# Deploy to Azure Static Web Apps (staging slot)
az staticwebapp deploy \
  --name <static-web-app-name> \
  --resource-group <resource-group> \
  --app-location ./dist \
  --environment staging

# Or deploy to CDN/Storage
```

**Database Migrations**:
```bash
# Run migrations in staging
dotnet ef database update --connection "staging-connection-string"

# Verify migration success
# Check data integrity
```

**Staging URL**: `https://staging-app.azurewebsites.net` or `https://staging.yourapp.com`

### Step 6: Staging Validation

Execute smoke tests in staging environment:

**Backend API Smoke Tests**:
```markdown
#### API Health Check
- [ ] GET /api/health ‚Üí 200 OK
- [ ] GET /api/v1/[resource] ‚Üí 200 OK (or 401 if auth required)
- [ ] POST /api/v1/[resource] ‚Üí 201 Created (with valid auth)

#### Feature-Specific Endpoints
- [ ] All new endpoints responding correctly
- [ ] Authentication working
- [ ] Authorization enforced
- [ ] Data persistence verified
- [ ] Error handling correct
```

**Frontend UI Smoke Tests**:
```markdown
#### UI Loading
- [ ] Application loads without errors
- [ ] Authentication flow works
- [ ] Navigation functional
- [ ] New feature accessible

#### Feature-Specific UI
- [ ] All new pages/components render
- [ ] Forms submit successfully
- [ ] Data displays correctly
- [ ] Error messages shown appropriately
```

**Critical User Journey**:
Test 1-2 most critical user journeys end-to-end in staging.

**Performance Check**:
- Verify API response times <200ms
- Verify UI load time <2s
- Check for console errors
- Monitor staging logs

**Issue Resolution**:
- If critical issues found: Fix and redeploy to staging
- If minor issues: Document and decide if blocking
- If staging passes: Proceed to production

### Step 7: Deploy to Production

**Pre-Production Checklist**:
```markdown
- [ ] Staging validation complete
- [ ] Deployment window scheduled
- [ ] Stakeholders notified
- [ ] Support team on standby
- [ ] Rollback plan ready
- [ ] Monitoring dashboards open
```

**Production Deployment**:

**Blue-Green Deployment** (Recommended):
```markdown
1. Deploy to "green" environment (new version)
2. Run smoke tests on green environment
3. Switch traffic from blue (old) to green (new)
4. Monitor green environment closely
5. Keep blue environment ready for rollback
```

**Rolling Deployment**:
```markdown
1. Deploy to first server/container
2. Health check passes
3. Deploy to next server/container
4. Repeat until all updated
5. Monitor throughout process
```

**Feature Flag Deployment**:
```markdown
1. Deploy code with feature disabled
2. Verify deployment successful
3. Enable feature via feature flag
4. Monitor adoption gradually
5. Can disable instantly if issues
```

**Backend Deployment**:
```bash
# Azure App Service production deployment
az webapp deployment source config-zip \
  --resource-group <resource-group> \
  --name <app-service-name-prod> \
  --src <build-artifact.zip>

# Monitor deployment logs
az webapp log tail --name <app-service-name-prod> --resource-group <resource-group>
```

**Frontend Deployment**:
```bash
# Deploy to production
az staticwebapp deploy \
  --name <static-web-app-name> \
  --resource-group <resource-group> \
  --app-location ./dist \
  --environment production

# Invalidate CDN cache if needed
az cdn endpoint purge --content-paths "/*" --profile-name <cdn-profile> --name <cdn-endpoint> --resource-group <resource-group>
```

**Database Migrations** (if applicable):
```bash
# Production database migration
# ENSURE BACKUP VERIFIED FIRST
dotnet ef database update --connection "production-connection-string"

# Monitor migration progress
# Verify data integrity immediately after
```

### Step 8: Production Validation

**Immediate Validation (First 5 minutes)**:
```markdown
#### Health Checks
- [ ] GET /api/health ‚Üí 200 OK
- [ ] Application loading without errors
- [ ] No 5xx errors in logs
- [ ] Error rate within normal range

#### Critical Path
- [ ] User login working
- [ ] Critical feature accessible
- [ ] Data loading correctly
```

**Extended Validation (First 30 minutes)**:
```markdown
#### Functional Testing
- [ ] All new endpoints responding
- [ ] Authentication working
- [ ] Authorization enforced
- [ ] Data persistence verified
- [ ] UI rendering correctly

#### Performance
- [ ] API response times <200ms (p95)
- [ ] UI load time <2s
- [ ] No performance degradation
- [ ] Database queries efficient

#### Monitoring
- [ ] Error rate stable or decreasing
- [ ] No new critical errors
- [ ] Performance metrics normal
- [ ] Infrastructure metrics healthy
```

**User Journey Testing**:
Test 2-3 critical user journeys in production with real accounts.

### Step 9: Post-Deployment Monitoring

**Critical Window (First 15 minutes)**:
- **Watch**: Error logs continuously
- **Monitor**: Error rate spikes
- **Check**: Performance degradation
- **Validate**: Critical features working
- **Decision Point**: GO or ROLLBACK

**First Hour**:
```markdown
#### Metrics to Monitor
- Application error rate (target: <1%)
- API response times (p50, p95, p99)
- Database connection pool usage
- Memory/CPU usage
- Request rate
- Active users

#### Log Analysis
- Check for new error patterns
- Verify no data corruption
- Validate integrations working
- Check authentication logs
```

**First 24 Hours**:
```markdown
#### Business Metrics
- Feature adoption rate
- User engagement
- Conversion metrics
- Customer support tickets

#### Technical Metrics
- Overall application health
- Performance trends
- Error patterns
- Infrastructure capacity
```

### Step 10: Rollback Decision

**Rollback Triggers** (Execute Immediate Rollback):
- Critical functionality broken
- Data corruption detected
- Security breach identified
- Error rate >5% for >5 minutes
- Performance degradation >50%
- Complete feature unavailability

**Rollback Execution**:

**Blue-Green Rollback**:
```bash
# Switch traffic back to blue (old version)
# Immediate, zero-downtime rollback
```

**Rolling Rollback**:
```bash
# Redeploy previous version to all servers
# Takes longer but straightforward
```

**Feature Flag Rollback**:
```bash
# Disable feature flag
# Instant rollback without redeployment
```

**Database Rollback** (if migration performed):
```bash
# Run rollback migration script
dotnet ef database update PreviousMigrationName --connection "production-connection-string"

# Verify data integrity after rollback
```

**Post-Rollback**:
- Notify stakeholders
- Document root cause
- Plan fix and redeployment
- Update deployment report

### Step 11: Update Documentation

**CHANGELOG.md**:
```markdown
## [1.2.0] - 2025-11-11

### Added
- Feature ####: [Feature name and description]
- API endpoint: POST /api/v1/[resource]
- UI component: [Component name]

### Changed
- Updated [component] to support [new capability]

### Fixed
- Resolved issue with [description]

### Security
- Added validation for [security improvement]

### Performance
- Optimized [query/component] reducing load time by X%
```

**API Documentation**:
- Update OpenAPI/Swagger documentation
- Document new endpoints
- Update request/response examples
- Note breaking changes (if any)

**User Documentation**:
- Update user guide with new feature
- Add screenshots/videos if helpful
- Document new workflows
- Update FAQ if needed

**Operations Runbook**:
```markdown
### Feature: ####-feature-name

#### Monitoring
- Dashboard: [URL]
- Key metrics: [List]
- Alert rules: [List]

#### Common Issues
- Issue: [Description]
  - Symptom: [What users see]
  - Diagnosis: [How to identify]
  - Resolution: [How to fix]

#### Rollback Procedure
1. [Step by step rollback instructions]
2. [Validation steps]
3. [Communication steps]
```

### Step 12: Generate Deployment Report

Create comprehensive `deployment-report.md`:

**Executive Summary**:
```markdown
# Deployment Report: ####-feature-name

**Deployment Date**: 2025-11-11  
**Deployment Status**: ‚úÖ SUCCESS / ‚ö†Ô∏è PARTIAL / ‚ùå FAILED  
**Production Readiness Score**: __/100  
**Rollback Executed**: YES / NO

## Summary
[Brief overview of deployment outcome]

## Key Metrics
- Deployment Duration: __ minutes
- Downtime: __ seconds (or zero downtime)
- Error Rate Impact: +__% / -__% / No change
- Performance Impact: __ ms average response time
- User Impact: __ active users during deployment
```

**Deployment Timeline**:
```markdown
## Deployment Timeline

| Time | Event | Status |
|------|-------|--------|
| 10:00 | Staging deployment started | ‚úÖ |
| 10:15 | Staging validation complete | ‚úÖ |
| 14:00 | Production deployment started | ‚úÖ |
| 14:20 | Production validation complete | ‚úÖ |
| 14:30 | Monitoring baseline established | ‚úÖ |
| 15:00 | All smoke tests passing | ‚úÖ |
```

**Validation Results**:
```markdown
## Production Validation

### Smoke Tests
- Health checks: ‚úÖ PASS
- Authentication: ‚úÖ PASS
- API endpoints: ‚úÖ PASS
- UI rendering: ‚úÖ PASS
- Critical journeys: ‚úÖ PASS

### Performance Metrics
- API p50: __ ms (target: <100ms)
- API p95: __ ms (target: <200ms)
- API p99: __ ms (target: <500ms)
- UI load time: __ s (target: <2s)
- Error rate: __% (target: <1%)

### Monitoring
- Application logs: Clean
- Error tracking: No new critical errors
- Performance dashboard: Within normal ranges
- Infrastructure metrics: Healthy
```

**Issues Encountered**:
```markdown
## Issues

### Critical Issues
_None_ ‚úÖ

### High Priority Issues
_None_ ‚úÖ

### Medium Priority Issues
- **ISSUE-001**: [Description]
  - Impact: [User/system impact]
  - Resolution: [How resolved or mitigation]
  - Status: RESOLVED / MONITORING

### Low Priority Issues
- Minor UI rendering delay in [component]
  - Monitoring, no user impact
```

**Rollback Plan Status**:
```markdown
## Rollback Capability

- Rollback Plan: READY / EXECUTED / NOT NEEDED
- Previous Version: v1.1.0 (tagged, available)
- Rollback Method: Blue-Green / Rolling / Feature Flag
- Rollback Time Estimate: <5 minutes (blue-green switch)
- Database Rollback: Scripts prepared, backup verified
```

**Post-Deployment Monitoring**:
```markdown
## Monitoring Plan

### First 24 Hours (Active Monitoring)
- [ ] Error rate: Monitored hourly
- [ ] Performance metrics: Monitored hourly
- [ ] User feedback: Support tickets reviewed
- [ ] Business metrics: Feature adoption tracked

### First Week (Enhanced Monitoring)
- [ ] Error patterns: Daily analysis
- [ ] Performance trends: Daily review
- [ ] User adoption: Daily metrics
- [ ] Support tickets: Categorized and reviewed

### Ongoing (Standard Monitoring)
- [ ] Application health: Standard dashboard
- [ ] Alerts: Production alert rules active
- [ ] Metrics: Weekly review
```

**Stakeholder Communication**:
```markdown
## Communication

### Deployment Announcement
**To**: Stakeholders, Users, Support Team  
**Subject**: Feature Deployed: [Feature Name]  
**Date**: 2025-11-11

Dear Team,

We've successfully deployed [feature name] to production.

**What's New**:
- [Key capability 1]
- [Key capability 2]
- [Key capability 3]

**User Impact**:
- [Describe any changes users will notice]
- [Link to user documentation]

**Known Issues**:
- [List if any, or state "None"]

**Feedback**:
Please report any issues to [support channel].

Thank you for your support!
```

**Lessons Learned**:
```markdown
## Lessons Learned

### What Went Well
- [Success 1]
- [Success 2]
- [Effective practice]

### What Could Be Improved
- [Challenge encountered]
- [Process improvement opportunity]
- [Tool/automation enhancement]

### Recommendations for Future Deployments
- [Recommendation 1]
- [Recommendation 2]
- [Best practice to adopt]
```

**Sign-Off**:
```markdown
## Deployment Sign-Off

| Role | Name | Signature | Date |
|------|------|-----------|------|
| Tech Lead | [Name] | _________ | 2025-11-11 |
| Solution Owner | [Name] | _________ | 2025-11-11 |
| Operations | [Name] | _________ | 2025-11-11 |

**Deployment Status**: APPROVED FOR PRODUCTION ‚úÖ
```

---

## Quality Checklist

Before completing Phase 8, verify:

### Deployment Execution
- [ ] Feature deployed to production successfully
- [ ] Zero downtime or scheduled downtime communicated
- [ ] All smoke tests passing in production
- [ ] No critical errors in production logs
- [ ] Performance within acceptable ranges

### Validation
- [ ] Critical user journeys tested in production
- [ ] Authentication and authorization working
- [ ] Data integrity verified
- [ ] Integrations functioning correctly
- [ ] Monitoring dashboards showing healthy metrics

### Documentation
- [ ] `deployment-plan.md` completed with pre-deployment checklist
- [ ] `deployment-report.md` generated with comprehensive results
- [ ] CHANGELOG.md updated with release notes
- [ ] API documentation updated (if endpoints changed)
- [ ] User documentation updated (if UI changed)

### Communication
- [ ] Stakeholders notified of successful deployment
- [ ] Support team briefed on new feature
- [ ] Known issues communicated (if any)
- [ ] Feedback channels established

### Monitoring
- [ ] Error tracking active and healthy
- [ ] Performance monitoring configured
- [ ] Alert rules firing correctly
- [ ] Dashboard accessible to operations team
- [ ] Baseline metrics established

### Rollback Readiness
- [ ] Rollback plan documented and ready
- [ ] Previous version tagged and available
- [ ] Database rollback scripts prepared
- [ ] Rollback can be executed in <5 minutes

### Phase Completion
- [ ] `progress.md` updated with Phase 8 complete
- [ ] Feature marked as deployed in tracking system
- [ ] Post-deployment review scheduled
- [ ] All Phase 8 artifacts saved in specification folder

---

## Example Deployment Report Snippet

```markdown
# Deployment Report: 0001-personal-goal-creation-management

**Deployment Date**: 2025-11-11 14:00 UTC  
**Deployment Status**: ‚úÖ SUCCESS  
**Production Readiness Score**: 92/100  
**Rollback Executed**: NO

## Summary
Successfully deployed Personal Goal Creation and Management feature to production using blue-green deployment strategy. Zero downtime achieved. All validation tests passing. Monitoring shows healthy metrics.

## Key Metrics
- Deployment Duration: 25 minutes
- Downtime: 0 seconds (blue-green deployment)
- Error Rate Impact: No change (0.3% baseline maintained)
- Performance Impact: 145ms average response time (within <200ms target)
- User Impact: 0 users affected (seamless transition)

## Deployment Timeline
| Time | Event | Status |
|------|-------|--------|
| 10:00 | Staging deployment | ‚úÖ Complete |
| 10:30 | Staging validation | ‚úÖ Passed |
| 14:00 | Production blue-green deployment | ‚úÖ Complete |
| 14:15 | Traffic switched to green | ‚úÖ Success |
| 14:20 | Smoke tests | ‚úÖ All passed |
| 14:30 | Extended validation | ‚úÖ All passed |
| 15:00 | Monitoring baseline | ‚úÖ Healthy |

## Validation Results
### Smoke Tests: ‚úÖ ALL PASSED
- Health check: 200 OK
- Authentication: Working
- Goal creation API: 201 Created (185ms avg)
- Goal list API: 200 OK (142ms avg)
- UI rendering: No errors

### Performance: ‚úÖ WITHIN TARGETS
- API p50: 98ms
- API p95: 178ms
- API p99: 245ms
- UI load: 1.2s
- Error rate: 0.3%

### Monitoring: ‚úÖ HEALTHY
- Application logs: Clean, no errors
- Error tracking: No critical issues
- Performance: Within normal range
- Infrastructure: CPU 35%, Memory 62%

## Issues: NONE ‚úÖ
No critical, high, or medium issues encountered during deployment.

## Rollback: NOT REQUIRED ‚úÖ
- Rollback plan was ready but not needed
- Previous version v1.0.0 available for instant rollback
- Blue environment kept warm for 24 hours

## Post-Deployment Monitoring
Active monitoring for 24 hours:
- Hourly error rate checks
- Hourly performance validation
- User feedback collection
- Support ticket monitoring

**Status**: Feature is stable and performing well. ‚úÖ
```

---

## Success Criteria

Phase 8 is complete when:
- ‚úÖ Feature successfully deployed to production
- ‚úÖ All smoke tests passing
- ‚úÖ Performance within targets
- ‚úÖ No critical errors
- ‚úÖ Stakeholders notified
- ‚úÖ Documentation updated
- ‚úÖ Monitoring active
- ‚úÖ `deployment-report.md` generated
- ‚úÖ Post-deployment review scheduled

---

## Next Steps After Phase 8

1. **Monitor for 24-48 hours**: Active monitoring of error rates, performance, and user adoption
2. **Collect feedback**: Gather user feedback through support channels
3. **Post-Deployment Review**: Team retrospective on deployment process
4. **Feature Adoption**: Track business metrics for feature usage
5. **Continuous Improvement**: Apply lessons learned to future deployments
6. **Plan Next Feature**: Return to Phase 1 for next feature in backlog

---

**Phase 8: Deploy Complete** üöÄ

Feature is now in production, serving users, and making an impact!
